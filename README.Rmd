---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  message = FALSE,
  warning = FALSE
)
```

# medmodr Package: Iterated Moderation and Mediation Analysis at Scale

<!-- badges: start -->
[![R-CMD-check](https://github.com/tosmartak/medmodr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/tosmartak/medmodr/actions/workflows/R-CMD-check.yaml)
[![License: GPL v3](https://img.shields.io/badge/License-GPL%20v3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
<!-- badges: end -->

We implement a `medmodr` package which helps you systematically sweep through combinations of variables to detect:

- **Moderation**: is the effect of an independent variable (X) on a dependent variable (Y) conditional on or moderated by a third variable (M)?
- **Mediation**: does an independent variable (X) influence a dependent variable (Y) indirectly through a third variable called a mediator (M)?

Instead of fitting models one by one, `medmodr` iterates across your variable sets and returns tidy summary tables you can filter, rank, and plot. It also automatically generates clean plots suitable for publications. This package builds upon the [`mediation`](https://CRAN.R-project.org/package=mediation) package [Tingley et al., 2014] for mediation analysis and the [`interactions`](https://CRAN.R-project.org/package=interactions) package [Long, 2024] for moderation plots.

## Installation

`medmodr` requires `R >= 4.1.0`.

You can install the released version of **medmodr** from CRAN with:

```{r install-cran, eval=FALSE}
install.packages("medmodr")
```

And you can install the development version from GitHub with:

```{r install-github, eval=FALSE}
# install.packages("pak")
pak::pak("tosmartak/medmodr")
# or alternatively:
# devtools::install_github("tosmartak/medmodr")
```

## Quick Start
Load the package and access the demo dataset included:

```{r setup-example, message=FALSE}
library(medmodr)
```

## Load Dataset

Below we load our small simulated dataset and run one moderation and one mediation analysis.

```{r simulate-dataset}
data("demo_medmodr")
knitr::kable(head(demo_medmodr))
```

**What each variable represents (for this README)**

- Treatments / Predictors: x1, x2 (numeric); grp (binary factor)
- Mediators: m1, m2 (numeric)
- Moderators: m1, m2, grp, edu (some numeric, some categorical)
- Outcomes: y1, y2 (numeric)
- Controls: c1, c2, edu (as covariates; can mix numeric and categorical)

This mirrors a realistic workflow where you scan multiple candidates at once.

### Moderation example

`run_moderation_paths()` loops over all `(predictor, moderator, outcome)` combinations and fits `lm()` with the interaction term. It returns one row per interaction term (or a summary row for categorical interactions if requested).

Below we intentionally pass `multiple variables` to each argument. Set plot_sig = FALSE here to keep knitting fast; you can enable plots in your own analysis by setting plot_sig = TRUE

```{r run-moderation}
mod_summary <- run_moderation_paths(
  data = demo_medmodr,
  predictors = c("x1", "x2"),
  moderators = c("m1", "grp", "edu"), # mix of numeric and categorical
  outcomes = c("y1", "y2"),
  controls = c("c1", "c2"),
  categorical_vars = c("grp", "edu"),
  sig_level = 0.05,
  plot_sig = FALSE, # set TRUE in your analysis to auto-plot significant interactions using the interaction package
  summarize_categorical = TRUE # summarize multiple dummy-by-interaction lines into a single row per categorical mod
)
```

The resulting dataset from our moderation analysis is shown below:

```{r view-moderation-dataset}
knitr::kable(head(mod_summary))
```

**What to look at:**

- `Term` is the specific interaction term (or a summary label for categorical moderators)

- `Interaction_Effect`, `Std_Error`, `T_value`, `P_value`, `CI_Lower`, `CI_Upper`

- `Has_Moderation` indicates significance at `sig_level`

### Mediation example
`run_mediation_paths()` loops over all `(treatment, mediator, outcome)` triples. For each triple it fits the two linear models and calls `mediation::mediate()` to estimate `ACME, ADE, Total Effect, and Proportion Mediated with 95% CIs`.

We pass **multiple treatments, mediators, and outcomes**. For speed in documentation, we use `sims = 200` and `boot = FALSE`. In real analysis, increase sims (e.g., 1000–5000) and consider boot = TRUE.

```{r run-mediation-analysis}
med_summary <- run_mediation_paths(
  data = demo_medmodr,
  treatments = c("x1", "x2"), # you can also include "grp" if you want to treat it as a treatment
  mediators = c("m1", "m2"),
  outcomes = c("y1", "y2"),
  controls = c("c1", "c2", "edu"),
  sims = 200, boot = FALSE, seed = 1
)
```

The resulting dataset from our mediation analysis is shown below:

```{r view-mediation-dataset}
knitr::kable(head(med_summary))
```

#### Visual summaries for mediation
These plots are fast for small tables but can be heavy on large scans, so we kept most of them eval=FALSE in README. Use them interactively in your analysis.

**Effect overview plot (ACME, ADE, Total Effect with CIs):**

By default, it would generate a summary grid plot for significant mediations only

```{r plot-med-summary-plot, eval=FALSE}
plot_mediation_summary_effects(med_summary, filter_significant = TRUE, summary_plot = TRUE)
```


**You can also show only ACME plots from significant results**
```{r, eval=FALSE}
plot_mediation_summary_effects(med_summary, filter_significant = TRUE, show_only_acme = TRUE, summary_plot = TRUE)
```

**You can equally loop over all significant mediation triples and plot each**

```{r, eval=FALSE}
plot_mediation_summary_effects(med_summary, filter_significant = TRUE, summary_plot = FALSE)
```

**You can also show only ACME for single plots**

```{r, eval=FALSE}
plot_mediation_summary_effects(med_summary, filter_significant = TRUE, summary_plot = FALSE, show_only_acme = TRUE)
```

## Learn more
Browse the vignettes for detailed workflow

- Topics covered in vignettes:

  - How to prepare your dataset

  - Detailed moderation and mediation workflows

  - Plotting significant results

  - Performance and reproducibility tips

## Function reference (quick)

- `run_moderation_paths(data, predictors, moderators, outcomes, controls, categorical_vars = NULL, sig_level = 0.05, plot_sig = FALSE, summarize_categorical = FALSE)` — loop over predictors × moderators × outcomes

- `run_mediation_paths(data, treatments, mediators, outcomes, controls, sims = 1000, boot = TRUE, seed = 123)` — loop over treatments × mediators × outcomes

- `plot_mediation_summary_effects(summary_table, filter_significant = FALSE, show_only_acme = FALSE)` — visualize significant mediation results

## License and issues

- [![License: GPL v3](https://img.shields.io/badge/License-GPL%20v3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

- Please file issues and feature requests on GitHub

- Contributions welcome (add tests where possible)

